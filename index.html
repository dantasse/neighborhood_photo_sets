<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Neighborhood Photo Sets</title>
<style>
.photos_column {
  padding: 5px;
  border: 1px solid;
}
#user_number {
  font-size: large;
}
.photo {
  width:300px;
  height:150px;
}
</style>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div id="intro" class="container-fluid">
      <div class="row">
        <div class="col-md-12">
          <h1>Neighborhood Photo Sets Study</h1>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <p>Thank you for your interest in this study. This is part of a research study conducted by Dan Tasse at Carnegie Mellon University and is funded by Yahoo Inc.</p> 
          <p>The purpose of the research is to understand how we can accurately compare neighborhoods using social media and other data sources.</p>
 
          <h3>Procedures</h3>
          <p>
After telling us which city and neighborhood you know well, we will present you with sets of photos from that neighborhood. We will ask you which set of photos better represents that neighborhood. After you complete 15 comparisons of photo sets, we will give you a code to put into Mechanical Turk to show that you have completed the task.
          </p>
 
          <h3>Participant Requirements</h3>
          <p>Participation in this study is limited to individuals age 18 and older who have lived in, or otherwise are very familiar with, one of the following cities: Pittsburgh, San Francisco, Houston, Austin, and Chicago</p>
 
          <h3>Risks</h3>
          <p>The risks and discomfort associated with participation in this study are no greater than those ordinarily encountered in daily life or during other online activities.</p>
 
          <h3>Benefits</h3>
          <p>There may be no personal benefit (besides monetary compensation) from your participation in the study but the knowledge received may be of value to humanity.</p>
 
          <h3>Compensation and Costs</h3>
          <p>You will be paid $1.00 for completing this task. If you do not complete the task, you will not be paid for partial completion.</p>
 
          <h3>Confidentiality</h3>
          <p>The data captured for the research does not include any personally identifiable information about you.  Your IP address will not be captured.</p>

          <h3>Right to Ask Questions and Contact Information</h3>
          If you have any questions about this study, you should feel free to ask them by contacting the Principal Investigator:<br>
          Dan Tasse, PhD Candidate<br>
          Human-Computer Interaction Department<br>
          5000 Forbes Ave, Pittsburgh, PA 15213<br>
          412-532-6827<br>
          dantasse@cmu.edu<br>
          <p>If you have questions later, desire additional information, or wish to withdraw your participation please contact the Principal Investigator by mail, phone or e-mail in accordance with the contact information listed above.</p>
 
          <p>If you have questions pertaining to your rights as a research participant; or to report concerns to this study, you should contact the Office of Research integrity and Compliance at Carnegie Mellon University.  Email: irb-review@andrew.cmu.edu. Phone: 412-268-1901 or 412-268-5460.</p>
 
<h3>Voluntary Participation</h3>
<p>Your participation in this research is voluntary.  You may discontinue participation at any time during the research activity.</p>
 
<ul style="list-style-type:none">
  <li><input type="checkbox" id="age_18" /> <label for="age_18">I am age 18 or older.</label></li>
  <li><input type="checkbox" id="read_and_understand" /> <label for="read_and_understand">I have read and understand the information above.</label></li>
  <li><input type="checkbox" id="want_to_participate" /> <label for="want_to_participate">I want to participate in this research and continue with the survey.</label></li>
  <li><input type="checkbox" id="have_lived_in" /> <label for="have_lived_in">I have lived in, or otherwise am very familiar with, at least one of the following cities: Pittsburgh, San Francisco, Houston, Austin, Chicago</label></li>
</ul>

<p>Which city and neighborhood do you know well?</p>
          <div style="padding: 5px;">
            <select id="city_selector" onchange="update_nghd_selector()">
              <option value="none">Select a city</option>
              <option id="austin" value="austin">Austin</option>
              <option id="chicago" value="chicago">Chicago</option>
              <option id="houston" value="houston">Houston</option>
              <option id="pgh" value="pgh">Pittsburgh</option>
              <option id="sf" value="sf">San Francisco</option>
            </select>
          </div>

          <div style="padding: 5px;">
            <select id="nghd_selector">
              <option value="none">Select a neighborhood (select a city first)</option>
            </select>
          </div>

          <div id="check_boxes_warning" style="color:red; display:none;">You must agree to the terms in order to continue with this study.</div>
          <div id="select_city_nghd_warning" style="color:red; display:none;">Please select a city and neighborhood</div>
          <div style="padding: 5px;"><button id="start_button" onclick="start()">Start</button></div>
        </div>
      </div>
    </div>

    <div id="main" class="container-fluid" style="display:none;">
      <div class="row">
        <div class="col-md-12"> <h1>Which set of photos better represents <span class="your_nghd"></span>?</h1> </div>
      </div>
      <div class="row">
        <div class="col-md-12"> Imagine you were trying to describe <span class="your_nghd"></span> to someone who had never been there. Which set would better help them understand the feel of <span class="your_nghd"></span>?</div>
      </div>
      <div class="row">
        <div class="photos_column col-md-6">
          <h3>Photo Set 1</h3>
          <div id="photos_1"> </div>
          <button id="group1_button" onclick="select_photos(1)">These photos represent <span class="your_nghd"></span> better</button>
        </div>
        <div class="photos_column col-md-6">
          <h3>Photo Set 2</h3>
          <div id="photos_2"> </div>
          <button id="group2_button" onclick="select_photos(2)">These photos represent <span class="your_nghd"></span> better</button>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12"><h3>Ratings completed: <span id="num_ratings_completed">0</span> / 15</h3></div>
      </div>
    </div>

    <div id="end" class="container-fluid" style="display:none;">
      <div class="row">
        <div class="col-md-12">
          <h1>Thank you!</h1>
          Thank you for participating in this study. Please enter this number:
          <div id="user_number"></div>
          into Mechanical Turk in order to receive credit for completing this HIT.
          <div id="error_boilerplate" style="display:none"><b>Some of your answers were not recorded.</b> Don't worry, you'll still get credit for completing this HIT. But please copy and paste the following into the 'Error Text' box on the HIT in Mechanical Turk:
            <div id="error_info"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
  <script>
    var selectedCity = ''
    var selectedNghd = ''
    var numCompleted = 0
    var comparisonsToDo = [[0,1], [0,2], [0,3], [0,4], [0,5],
      [1,2], [1,3], [1,4], [1,5], [2,3], [2,4], [2,5], [3,4], [3,5], [4,5]]
    var userNumber = Math.floor(Math.random() * 1000000000)
    var nghdList = {}
    var urls = {} // e.g. {'pgh': {'Shadyside': {'twitter_random': ['www.twimg.com/...', ...]}}}
    $.getJSON("data/nghd_list.json", function(json) {
      nghdList = json
    })
    $.getJSON("data/urls.json", function(json) {
      urls = json
    })
    var userLog = [] // Build this up if the AJAX requests start failing. 

    var update_nghd_selector = function() {
      $("#nghd_selector").empty()
      var city = $("#city_selector").val()
      if (city === "none") {
        return
      } else {
        for (var i = 0; i < nghdList[city].length; i++) {
          var nghd = nghdList[city][i]
          $("#nghd_selector").append('<option value="' + nghd + '">'+ nghd + '</option>')
        }
      }
    }
    var start = function() {
      $("#check_boxes_warning").hide()
      $("#select_city_nghd_warning").hide()
      selectedCity = $("#city_selector").val()
      selectedNghd = $("#nghd_selector").val()
      if (!($("#age_18").is(":checked") && $("#read_and_understand").is(":checked") &&
        $("#want_to_participate").is(":checked") && $("#have_lived_in").is(":checked"))) {
        $("#check_boxes_warning").show()
        return false
      }
      if (selectedCity === 'none' || selectedNghd === 'none') {
        $("#select_city_nghd_warning").show()
        return false
      }
      
      numCompleted = 0
      prepare_photos()
      $("#intro").hide()
      $("#main").show()
      $(".your_nghd").text(selectedNghd)
      $("#end").hide()
    }
    var done = function() {
      $("#intro").hide()
      $("#main").hide()
      $("#user_number").text(userNumber)
      $("#end").show()

      if (userLog.length > 0) {
        $("#error_boilerplate").show()
        var errorText = JSON.stringify(userLog)
        $("#error_info").text(errorText)
      }
    }

    // Types: 0 = twitter random, 1 = street view random, 2 = street view at
    // venues, 3 = flickr random, 4 = flickr with only "outdoor" photos,
    // 5 = flickr with TF-iDF-UF of some kind.
    var typeMap = {0: 'twitter_random', 1: 'streetview_random', 2: 'streetview_venues',
      3: 'flickr_random', 4: 'flickr_selected_tags', 5: 'flickr_jaffe'}
    var getUrls = function(city, nghd, photo_type) {
      return urls[city][nghd][photo_type]
    }

    var prepare_photos = function() {
      var comparisonToDo = comparisonsToDo.splice(Math.floor(Math.random() * comparisonsToDo.length), 1)[0]
      // splice also removes it from the list.
      if (Math.random() > 0.5) {
        firstSet = comparisonToDo[0]
        secondSet = comparisonToDo[1]
      } else {
        firstSet = comparisonToDo[1]
        secondSet = comparisonToDo[0]
      }
      // so now firstSet = 3 and secondSet = 2 or something.
      urls1 = getUrls(selectedCity, selectedNghd, typeMap[firstSet]).slice(0, 10)
      urls2 = getUrls(selectedCity, selectedNghd, typeMap[secondSet]).slice(0, 10)
      $("#photos_1").empty()
      $("#photos_2").empty()
      for (var i = 0; i < 10; i++) {
        if (i < urls1.length) {
          $("#photos_1").append('<img class="photo" src="' + urls1[i] + '"/>')
        }
        if (i < urls2.length) {
          $("#photos_2").append('<img class="photo" src="' + urls2[i] + '"/>')
        }
      }

    }
    var select_photos = function(group_num) {
      numCompleted += 1

      if (group_num === 1) {
        winner = typeMap[firstSet]
        loser = typeMap[secondSet]
      } else if (group_num === 2) {
        winner = typeMap[secondSet]
        loser = typeMap[firstSet]
      }
      var params = {'winner': winner, 'loser': loser, 'city': selectedCity,
        'neighborhood': selectedNghd, 'user': userNumber,
        'winner_position': group_num, 'num_completed': numCompleted}
      $.ajax({url: 'https://script.google.com/macros/s/AKfycbwo53FphJlEQYw8wk98_B6DrX73G2SqLHUhwBIunrhQti5INT8s/exec',
        type: 'post',
        data: params}).fail(function () {
          userLog.push(params)
        })
      if (numCompleted >= 15) {
        done()
      } else {
        $("#num_ratings_completed").text(numCompleted)
        prepare_photos()
      }
    }
  </script>
  </body>
</html>
